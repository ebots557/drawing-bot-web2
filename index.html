<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Doodle Drawing App</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body { background: #121212; color: white; font-family: 'Segoe UI', sans-serif; text-align: center; margin: 0; overflow: hidden; height: 100vh; display: flex; flex-direction: column; }
        .header { padding: 15px; font-weight: bold; background: #1f1f1f; display: flex; justify-content: space-between; border-bottom: 2px solid #333; }
        canvas { background: white; touch-action: none; border-radius: 15px; margin: 15px auto; box-shadow: 0 0 20px rgba(0,0,0,0.5); cursor: crosshair; }
        .toolbar { padding: 10px; background: #1f1f1f; display: flex; justify-content: space-around; align-items: center; border-top: 1px solid #333; }
        .btn { padding: 12px 25px; border: none; border-radius: 12px; font-weight: bold; cursor: pointer; transition: 0.2s; }
        .clear { background: #333; color: #ff4757; border: 1px solid #444; }
        .submit { background: #2ed573; color: white; flex-grow: 1; margin-left: 10px; font-size: 16px; }
        .tool-icons { display: flex; justify-content: center; gap: 15px; padding: 10px; background: #121212; }
        .icon { width: 45px; height: 45px; background: #1f1f1f; border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 20px; border: 1px solid #333; transition: 0.3s; }
        .active-tool { border-color: #2ed573; background: #262626; box-shadow: 0 0 10px #2ed573; }
    </style>
</head>
<body>

<div class="header">
    <span style="color: #2ed573;">‚úèÔ∏è DRAW NOW</span>
    <span id="timer" style="color: #ffa502;">02:00</span>
</div>

<canvas id="canvas"></canvas>

<div class="tool-icons">
    <div id="pencil-btn" class="icon active-tool" onclick="setTool('pencil')">‚úèÔ∏è</div>
    <div id="eraser-btn" class="icon" onclick="setTool('eraser')">‚ö™</div>
    <div class="icon" onclick="clearCanvas()">üßº</div>
</div>

<div class="toolbar">
    <button class="btn clear" onclick="clearCanvas()">RESET</button>
    <button class="btn submit" onclick="sendToBot()">SEND TO GROUP</button>
</div>

<script>
    const tg = window.Telegram.WebApp;
    tg.expand();

    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');
    
    canvas.width = window.innerWidth - 30;
    canvas.height = window.innerHeight * 0.55;

    let drawing = false;
    let currentTool = 'pencil';

    ctx.lineWidth = 4;
    ctx.lineCap = 'round';
    ctx.strokeStyle = '#000000';

    function setTool(tool) {
        currentTool = tool;
        document.getElementById('pencil-btn').classList.remove('active-tool');
        document.getElementById('eraser-btn').classList.remove('active-tool');
        
        if(tool === 'pencil') {
            ctx.strokeStyle = '#000000';
            ctx.lineWidth = 4;
            document.getElementById('pencil-btn').classList.add('active-tool');
        } else {
            ctx.strokeStyle = '#FFFFFF'; // Eraser (White color)
            ctx.lineWidth = 15;
            document.getElementById('eraser-btn').classList.add('active-tool');
        }
    }

    function getPos(e) {
        let x, y;
        let rect = canvas.getBoundingClientRect();
        if (e.touches) {
            x = e.touches[0].clientX - rect.left;
            y = e.touches[0].clientY - rect.top;
        } else {
            x = e.clientX - rect.left;
            y = e.clientY - rect.top;
        }
        return {x, y};
    }

    function start(e) { drawing = true; draw(e); }
    function stop() { drawing = false; ctx.beginPath(); }
    
    function draw(e) {
        if (!drawing) return;
        e.preventDefault();
        const pos = getPos(e);
        ctx.lineTo(pos.x, pos.y);
        ctx.stroke();
    }

    canvas.addEventListener('touchstart', start);
    canvas.addEventListener('touchmove', draw);
    canvas.addEventListener('touchend', stop);
    canvas.addEventListener('mousedown', start);
    canvas.addEventListener('mousemove', draw);
    canvas.addEventListener('mouseup', stop);

    function clearCanvas() { ctx.clearRect(0, 0, canvas.width, canvas.height); }

    function sendToBot() {
        const dataURL = canvas.toDataURL('image/png');
        tg.sendData(dataURL);
        tg.close();
    }

    tg.ready();
</script>
</body>
</html>
